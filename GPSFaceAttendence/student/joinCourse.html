<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta charset="utf-8">
		<title></title>
		<style>
			* {
		    margin: 0;
		    padding: 0;
		    box-sizing: border-box;
		  }
		
		  body {
		    background-color: #ffffff;
		    font-family: -apple-system, PingFang SC, Hiragino Sans GB, Helvetica Neue, Arial;
		    -webkit-tap-highlight-color: transparent;
		  }
		
		  .app {
		    padding-left: 20px;
		    padding-right: 20px;
		    padding-top: 60px;
		    max-width: 320px;
		    margin-left: auto;
		    margin-right: auto;
		  }
		  .heading-2 {
		    color: #333333;
		  }
		  .v-code {
		    margin-top: 20px;
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: flex;
		    -webkit-box-pack: justify;
		    -ms-flex-pack: justify;
		    justify-content: space-between;
		    -webkit-box-align: center;
		    -ms-flex-align: center;
		    align-items: center;
		    position: relative;
		    width: 280px;
		    margin-left: auto;
		    margin-right: auto;
		  }
		
		  .v-code input {
		    position: absolute;
		    top: -100%;
		    left: -666666px;
		    opacity: 0;
		  }
		
		  .v-code .line {
		    position: relative;
		    width: 40px;
		    height: 32px;
		    line-height: 32px;
		    text-align: center;
		    font-size: 28px;
		  }
		  .v-code .line::after {
		    display: block;
		    position: absolute;
		    content: '';
		    left: 0;
		    width: 100%;
		    bottom: 0;
		    height: 1px;
		    background-color: #aaaaaa;
		    transform: scaleY(.5);
		    transform-origin: 0 100%;
		  }
		  .v-code .line.animated::before {
		    display: block;
		    position: absolute;
		    left: 50%;
		    top: 20%;
		    width: 1px;
		    height: 60%;
		    content: '';
		    background-color: #333333;
		    animation-name: coruscate;
		    animation-duration: 1s;
		    animation-iteration-count: infinite;
		    animation-fill-mode: both;
		  }
		
		  /*.v-code .line.animated::before {
		    display: block;
		    content: '';
		    position: absolute;
		    left: 0;
		    bottom: -1px;
		    width: 100%;
		    height: 2px;
		    background-color: #000000;
		  }*/
		
		  @keyframes coruscate {
		    0% {
		      opacity: 0
		    }
		    25% {
		      opacity: 0
		    }
		    50% {
		      opacity: 1
		    }
		    75% {
		      opacity: 1
		    }
		    to {
		      opacity: 0
		    }
		  }
		  </style>

	</head>
	<body>
		<div id="app" class="app">
			<h2 class="heading-2">验证码:</h2>
			<div class="v-code">
				<input ref="vcode" id="vcode" type="tel" maxlength="4" v-model="aCodes" @focus="focused = true" @blur="focused = false"
				 :disabled="telDisabled">

				<label for="vcode" class="line" v-for="item,index in codeLength" :class="{'animated': focused && cursorIndex === index}"
				 v-text="codeArr[index]">
				</label>
			</div>
		</div>
             <script src="../js/configurl.js"></script>     
		<script src="../js/vue.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script>
			mui.init();
			// import constant from '../js/vue-PortIp.vue',
			var app = new Vue({
				el: '#app',
				data: {
					aCodes: '',
					codeLength: 4,
					telDisabled: false,
					focused: false,
					number:'',
				},
				created() {
					var all = this;
					var url = getport() +'/student/findByOpenid';
					mui.ajax(url, {
						data: {
							openid:JSON.parse(localStorage.getItem('person')).openid
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；
						success: function(data) {
							all.number = data.message.number;
						},
						error: function(xhr, type, errorThrown) {
							if (type == "timeout") {
								mui.alert("请求超时，请检查网络或重试");
							} else {
								mui.alert("未知网络错误");
							}
							console.log(type);
							console.log(errorThrown);
						}
					});
					
					
					
				},
				computed: {
					codeArr() {
						return this.aCodes.split('')
					},
					cursorIndex() {
						return this.aCodes.length
					}
				},
				watch: {
					aCodes(newVal) {
						this.aCodes = newVal.replace(/[^\d]/g, '')
						if (newVal.length == 4) {
							// this.telDisabled = true
							this.$refs.vcode.blur()
							// alert((this.number));
							this.join(this.number,parseInt(this.aCodes))

						}
					}
				},
				methods: {
					join: function(number, courseCode) {
					
						var url = getport() +'/course/joinCourse';
						mui.ajax(url, {
							data: {
								number:number,
								courseCode:courseCode
							},
							dataType: 'json', //服务器返回json格式数据
							type: 'post', //HTTP请求类型
							timeout: 10000, //超时时间设置为10秒；
							success: function(data) {
								console.log(JSON.stringify(data));
								alert(JSON.stringify(data));
							},
							error: function(xhr, type, errorThrown) {
								if (type == "timeout") {
									mui.alert("请求超时，请检查网络或重试");
								} else {
									mui.alert("未知网络错误");
								}
								console.log(type);
								console.log(errorThrown);
							}
						});
					}
				},


				mounted() {


				}
			})
		</script>
	</body>
</html>
